<!-- <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script> -->
<!-- <script src="https://cdn11.bigcommerce.com/s-h4smy34w/content/imegawidget-custom.js"></script> -->
<!-- <script src="{{cdn 'webdav:imegawidget-custom.js'}}"></script> -->
<!-- <script>
		$(document).ready(function(){
		    imegaCalculator.init({
		        apiKey: 'a8346514700102e3a47df85b9ff606ad',
		        description: '{{ product.title }}',
		        insertion: 'after',
		        element: '.productView-options',
		        margin:'1rem 0',
		        priceElement: '.price--actual',
		        amount: '{{ product.price.with_tax.value }}', //use if priceElement not set
		        financeFilter:getFinanceFilter('{{ product.title }}')
		    });
		});
		function getFinanceFilter(productDesc) 
		{
		 
            const tiers = {
                'Tier 1' : ['Sale'],
                'Tier 2' : ['| Evil', '| Yeti'],
                'Tier 3' : ['| Cube', '| Gocycle', '| Mondraker', '| Whyte', '| Transition', '| Moustache', '| Marin'],
                'Tier 4' : ['| Trek', '| Nukeproof', '| Ragley', '| NS Bikes', '| Orbea'],
                'Tier 5' : ['Evil', 'Yeti'],
                'Tier 6' : ['Cube', 'Gocycle', 'Mondraker', 'Whyte', 'Transition', 'Moustache', 'Marin'],
                'Tier 7' : ['Trek', 'Nukeproof', 'Ragley', 'NS Bikes', 'Orbea'],
            };
            var filter;
        
            for (var key in tiers) {
                const filterFinder = tiers[key].some(element => {
                    if (productDesc.includes(element)) {
                        return true;
                    }
                });
                if (filterFinder) {
                    filter = key;
                    break;
                }
            }
            if (!filter) {
                filter = 'ALL';
            }
		    return filter;
		}
		jQuery.noConflict(true);
</script>  -->
<!-- <script type="text/javascript">
			jQuery("#imega-widget").appendTo('#imega-widget-anchor')    
		</script> -->

<script>
var timePrice = 0;
var formSelect = document.querySelectorAll(".productView-options .form-select");
for (let i = 0; i < formSelect.length; i++) {
	formSelect[i].addEventListener("change", function() {
		clearTimeout(timePrice);
	    timePrice = setTimeout(function() {
			var newPriceCurrency = document.querySelector(".productView-price span[data-product-price-with-tax]").textContent;
			var newPriceNumber = Number(newPriceCurrency.replace(/[^0-9\.-]+/g,""));		
			var newPriceKlarna = newPriceNumber * 100;
			document.querySelector('klarna-placement').dataset.purchaseAmount = newPriceKlarna;
			window.Klarna.OnsiteMessaging.refresh();
	    }, 1000);
	});
}
</script>
		