{{assignVar "vStock" "false"}}

{{#if gql.data.site.product}}
	{{#if gql.data.site.product.inventory.hasVariantInventory}}
		{{assignVar "vStock" "true"}}
	{{/if}}
{{/if}}

<div class="product-icons-container">
	<div class="product-icons">
		<div class="product-icon product-icon-alt">
            <a class="product-icon-text" href="/price-match-request/?url={{settings.secure_base_url}}{{settings.request.absolute_path}}">Price Match Request</a>
		</div>
		{{#if (getVar "vStock") '===' 'true'}}
		<div class="product-icon">
			<a class="product-icon-text" href="#modalAvailability" data-reveal-id="modalAvailability">Check Availability</a>
		</div>
		{{/if}}
	</div>
</div>
{{#if (getVar "vStock") '===' 'true'}}
<div id="modalAvailability" class="modal modal--small" data-reveal>
    {{> components/common/modal/modal-close-btn}}
    <div class="modal-body">
        <div class="variant-data">
			<div class="table-scroll">
				<table class="table">
					<tbody>
					{{#each gql.data.site.product.variants.edges}}
						<tr{{#with node}}{{#unless isPurchasable}} class="tr-variant-unavailable"{{/unless}}{{/with}}>
						    {{#with node}}
						        {{#each productOptions.edges}}
						            {{#with node}}
						                {{#each values.edges}}
						                    {{#with node}}
						                        <td class="td-option td-{{dashcase (lowercase (sanitize ../../displayName))}}">{{label}}</td>
						                    {{/with}}
						                {{/each}}
						            {{/with}}
						        {{/each}}
						        <td class="td-price">
									{{#if ../../product.price.without_tax}}
										{{exclTax.price.formatted}}
									{{else}}
										{{inclTax.price.formatted}}
									{{/if}}
								</td>
								<td class="td-stock">
								    <span class="td-stock-text">
									{{#if inventory.aggregated.availableToSell '==' 0}}
										Sold Out. <a href="/contact-us/">Contact</a> For Alternatives
									{{else if inventory.aggregated.availableToSell '<=' 100}}
										IN STOCK Dispatch Same Day
									{{else if inventory.aggregated.availableToSell '<=' 500}}
										Supplier Warehouse Dispatch Within 1 Week
									{{else if inventory.aggregated.availableToSell '<=' 1000}}
										IN STOCK Dispatch Within 1 Week
									{{else if inventory.aggregated.availableToSell '<=' 2000}}
										IN STOCK Dispatch Within 2 Weeks
									{{else if inventory.aggregated.availableToSell '<=' 2500}}
										IN STOCK Dispatch Within 3 Weeks
									{{else if inventory.aggregated.availableToSell '<=' 3000}}
										IN STOCK Dispatch Within 3 Days
									{{else if inventory.aggregated.availableToSell '<=' 4000}}
										IN STOCK Dispatch Within 24 Hours
									{{else if inventory.aggregated.availableToSell '<=' 5000}}
										IN STOCK Dispatch Today (Before 1pm)
									{{else if inventory.aggregated.availableToSell '<=' 5200}}
										Due: January
									{{else if inventory.aggregated.availableToSell '<=' 5400}}
										Due: February
									{{else if inventory.aggregated.availableToSell '<=' 5600}}
										Due: March
									{{else if inventory.aggregated.availableToSell '<=' 5800}}
										Due: April
									{{else if inventory.aggregated.availableToSell '<=' 6000}}
										Due: May
									{{else if inventory.aggregated.availableToSell '<=' 6200}}
										Due: June
									{{else if inventory.aggregated.availableToSell '<=' 6400}}
										Due: July
									{{else if inventory.aggregated.availableToSell '<=' 6600}}
										Due: August
									{{else if inventory.aggregated.availableToSell '<=' 6800}}
										Due: September
									{{else if inventory.aggregated.availableToSell '<=' 7000}}
										Due: October
									{{else if inventory.aggregated.availableToSell '<=' 7200}}
										Due: November
									{{else if inventory.aggregated.availableToSell '<=' 7400}}
									    Due: December
									{{else if inventory.aggregated.availableToSell '<=' 7600}}
									    Expected Date To Be Confirmed
									{{else}}
										No Availabilty Info
									{{/if}}
									</span>
								</td>
						    {{/with}}
						</tr>
					{{/each}}
					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>
{{/if}}
